<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="description" content="訪問履歴">
  <meta name="theme-color" content="#2196F3">
  <title>訪問履歴</title>
  
  <link rel="manifest" href="/manifest.json">
  <link rel="stylesheet" href="/css/style.css">
  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
  <style>
    #map {
      width: 100%;
      height: 300px;
      border-radius: 8px;
      margin-bottom: 16px;
    }

    .history-detail-header {
      background: white;
      padding: 16px;
      margin-bottom: 16px;
      border-radius: 8px;
      box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
      display: none;
    }

    .history-detail-header.active {
      display: block;
    }

    .point-name {
      font-size: 24px;
      font-weight: 700;
      color: #2196F3;
      margin-bottom: 8px;
    }

    .point-info-grid {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 12px;
      margin-bottom: 16px;
    }

    .info-item {
      padding: 12px;
      background: #f5f5f5;
      border-radius: 4px;
    }

    .info-label {
      font-size: 12px;
      color: #666;
      margin-bottom: 4px;
    }

    .info-value {
      font-size: 16px;
      font-weight: 600;
      color: #333;
    }

    .history-list {
      list-style: none;
      padding: 0;
    }

    .history-item {
      background: white;
      padding: 16px;
      margin-bottom: 12px;
      border-radius: 8px;
      border-left: 4px solid #2196F3;
      cursor: pointer;
      transition: all 0.3s ease;
      box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
    }

    .history-item:hover {
      transform: translateX(4px);
      box-shadow: 0 4px 8px rgba(0, 0, 0, 0.15);
    }

    .history-item-title {
      font-size: 18px;
      font-weight: 700;
      color: #2196F3;
      margin-bottom: 8px;
    }

    .history-item-meta {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 8px;
      margin-bottom: 8px;
    }

    .history-item-meta-item {
      font-size: 12px;
      color: #666;
    }

    .history-item-notes {
      font-size: 14px;
      color: #333;
      padding-top: 8px;
      border-top: 1px solid #e0e0e0;
      margin-top: 8px;
    }

    .back-button {
      display: inline-block;
      margin-bottom: 16px;
      padding: 8px 16px;
      background: #f5f5f5;
      color: #333;
      text-decoration: none;
      border-radius: 4px;
      font-size: 14px;
      font-weight: 600;
      cursor: pointer;
    }

    .back-button:hover {
      background: #e0e0e0;
    }

    .photos-grid {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 12px;
      margin-bottom: 16px;
    }

    .photo-item {
      border-radius: 8px;
      overflow: hidden;
      background: #f5f5f5;
      aspect-ratio: 3 / 4;
    }

    .photo-item img {
      width: 100%;
      height: 100%;
      object-fit: cover;
    }

    .photo-label {
      font-size: 12px;
      text-align: center;
      padding: 8px;
      background: #f5f5f5;
      color: #666;
    }
  </style>
</head>
<body>
  <header>
    <h1>訪問履歴</h1>
    <p class="subtitle">探索した基準点の記録</p>
  </header>

  <main>
    <div class="container">
      <!-- 検索・フィルター -->
      <div class="search-form">
        <div class="form-group">
          <label for="history-search">点名で検索</label>
          <input type="text" id="history-search" placeholder="点名を入力">
        </div>

        <div class="form-group">
          <label for="history-type-filter">基準点種別</label>
          <select id="history-type-filter">
            <option value="">すべて</option>
            <option value="三角点">三角点</option>
            <option value="水準点">水準点</option>
            <option value="電子基準点">電子基準点</option>
          </select>
        </div>

        <div class="form-group">
          <label for="history-sort">ソート</label>
          <select id="history-sort">
            <option value="date">探索日順（新しい順）</option>
            <option value="date-old">探索日順（古い順）</option>
            <option value="type">基準点種別</option>
            <option value="name">点名順</option>
          </select>
        </div>

        <button class="btn btn-block" id="history-filter-btn">フィルター</button>
      </div>

      <!-- 履歴一覧 -->
      <div id="history-list-container">
        <ul class="history-list" id="history-list">
          <li class="history-item" style="border: none; cursor: default;">
            <div class="text-center text-muted p-16">
              訪問履歴がありません
            </div>
          </li>
        </ul>
      </div>

      <!-- 詳細表示（クリック時） -->
      <div class="history-detail-header" id="history-detail">
        <a href="javascript:void(0)" class="back-button" onclick="closeHistoryDetail()">← 一覧に戻る</a>
        
        <div class="point-name" id="detail-point-name">点名</div>
        
        <div class="point-info-grid">
          <div class="info-item">
            <div class="info-label">基準点種別</div>
            <div class="info-value" id="detail-point-type">三角点</div>
          </div>
          <div class="info-item">
            <div class="info-label">都道府県</div>
            <div class="info-value" id="detail-point-prefecture">東京都</div>
          </div>
          <div class="info-item">
            <div class="info-label">市区町村</div>
            <div class="info-value" id="detail-point-city">千代田区</div>
          </div>
          <div class="info-item">
            <div class="info-label">標高</div>
            <div class="info-value" id="detail-point-elevation">6.2m</div>
          </div>
        </div>

        <div id="map"></div>

        <div class="card">
          <div class="card-header">
            <h3>探索情報</h3>
          </div>
          <div class="card-body">
            <div class="point-info-grid">
              <div class="info-item">
                <div class="info-label">探索日</div>
                <div class="info-value" id="detail-visit-date">--</div>
              </div>
              <div class="info-item">
                <div class="info-label">天気</div>
                <div class="info-value" id="detail-visit-weather">--</div>
              </div>
            </div>

            <div class="info-item mt-16">
              <div class="info-label">メモ</div>
              <div class="info-value" id="detail-visit-notes" style="font-size: 14px; font-weight: 400;">
                メモなし
              </div>
            </div>
          </div>
        </div>

        <div class="card" id="photos-card">
          <div class="card-header">
            <h3>撮影写真</h3>
          </div>
          <div class="card-body">
            <div class="photos-grid" id="detail-photos-grid">
            </div>
          </div>
        </div>
      </div>
    </div>
  </main>

  <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
  <script src="/js/db.js"></script>
  <script src="/js/history.js"></script>
</body>
</html>
